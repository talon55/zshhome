# NVM Support

export NVM_DIR="${ZDOTDIR:-$HOME}/.nvm"

# Make the directory if it doesn't exist
[[ -d "$NVM_DIR" ]] || mkdir "$NVM_DIR"

# Get nvm.sh location
if hash brew 2>/dev/null && brew list --versions nvm &>/dev/null; then
  nvm="$(brew --prefix nvm)/nvm.sh"
  comp="$(brew --prefix nvm)/etc/bash_completion.d/nvm"
elif [[ -f "$NVM_DIR/nvm.sh" ]]; then
  nvm="$NVM_DIR/nvm.sh"
  comp="$NVM_DIR/bash_completion"
else
  return
fi

# Load nvm
[[ -s "$nvm" ]] && \. "$nvm"

# place this after nvm initialization
autoload -U add-zsh-hook
load-nvmrc() {
  if command -v nvm >/dev/null 2>&1; then
    if [[ -f .nvmrc && -r .nvmrc  ]]; then
      nvm use
    elif [[ $(nvm version) != $(nvm version default)   ]]; then
      echo "Reverting to nvm default version"
      nvm use default
    fi
  fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc

# Load bash completion
[[ -s "$comp" ]] && \. "$comp"
